#!!!PERLPATH!!
#
# post - run post-installation actions
#
# Copyright (C) 2007-2009 Carnegie Mellon University
#
# This program is free software; you can redistribute it and/or modify it
# under the terms of version 2 of the GNU General Public License as published
# by the Free Software Foundation.  A copy of the GNU General Public License
# should have been distributed along with this program in the file
# LICENSE.GPL.
#
# This program is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
# or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
# for more details.
#

use strict;
use warnings;
use Term::ANSIColor;
use constant {
	SBINDIR => "!!SBINDIR!!",
	ISRGROUP => "!!ISRGROUP!!",
};

sub fail ($) {
	my $msg = shift;

	print colored("Failed: $msg", "red") . "\n";
	exit 1;
}

sub warning ($) {
	my $msg = shift;

	print colored("Warning: $msg", "yellow") . "\n";
}

sub status ($) {
	my $msg = shift;

	print colored($msg, "green") . "\n";
}

fail "You must be root."
	if $> != 0;

# Create the ISRGROUP group if it doesn't already exist
unless (defined getgrnam(ISRGROUP)) {
	status "Creating " . ISRGROUP . " group...";
	system("groupadd " . ISRGROUP) == 0
		or fail "Couldn't create " . ISRGROUP . " group";
}

# Print final thoughts
status "Setup succeeded.";
my $grp = ISRGROUP;
print <<EOF;
Any user who will use OpenISR must be added to the "$grp" group.

EOF

exit 0;
