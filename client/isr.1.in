.\" =========================================================================
.\" isr - Client user interface for the Internet Suspend/Resume (R) system
.\" 
.\" Copyright (C) 2004-2007 Carnegie Mellon University
.\" 
.\" This software is distributed under the terms of the Eclipse Public
.\" License, Version 1.0 which can be found in the file named LICENSE.Eclipse.
.\" ANY USE, REPRODUCTION OR DISTRIBUTION OF THIS SOFTWARE CONSTITUTES
.\" RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT
.\" ==========================================================================
.\"
.TH ISR 1 "Nov 30, 2007" "OpenISR !!VERSION!!" "User Commands"
.LO 1

.SH NAME
isr \- Internet Suspend/Resume client program

.SH SYNOPSIS
.B isr 
.I command
.RI [ parcel ]
.RB [ \-bcdeFlqv ]
.RB [ \-r
.IR version ]
.RB [ \-s
.IR server ]
.RB [ \-u
.IR userid ]
.RB [ \-L
.IR count ]

.I Commands: 
.B auth, checkin (ci), checkout (co), checkhoard, checkp, clean, deauth, discard, help, hoard, ls, lshoard, passwd, resume, rmhoard, stat, sync, version

.SH DESCRIPTION
An Internet Suspend/Resume\*R (ISR) system is a collection of
virtual machine
.I parcels
on a 
.IR server ,
together with a set of 
.IR "client hosts" ,
each loaded with the 
.B isr
client program and a 
.IR "virtual machine monitor" .
A parcel is a set of data that represents all of the state of some
virtual machine in execution, and includes a
.IR keyring ", a " "memory image" ", and a " "virtual disk" .
The server maintains checkpointed versions of each parcel.

Each ISR user has a unique
.I ISR userid
and a corresponding 
.I ISR password
on the server.
Distinct ISR userids own disjoint sets of parcels. Parcels are not
shared across ISR userids. At any point in time, a parcel can be
checked out on at most one client host. A simple locking mechanism
enforces this policy.


The 
.B isr
client program provides commands to 
.I checkout 
(download) parcels from the server to the client host, 
run parcels on the client host, 
.I checkin 
(upload) parcels from the client
host back to the server, query the status of parcels,
authenticate to the ISR system, and change the ISR password.
Downloading and running a parcel is known as 
.I resuming
the parcel. 
Locally suspending the virtual machine monitor 
and then uploading the parcel back
to the server is known as
.I suspending
the parcel.

The 
.B isr
client program also provides a command to
.B hoard
parcel state into a persistent 
.I hoard cache
on the client host.
A fully-hoarded parcel is one where the hoard cache contains the parcel's
entire virtual disk state; thus the parcel, once checked out, can be
resumed
.I disconnected
(without a network connection). Use the 
.B lshoard
command to view the state of the hoard cache on your client, and the
.B stat
command to see how much of a particular parcel is currently hoarded.

On a particular client host, the
.I default server
is given by the 
.I server 
variable in 
.IR !!SHAREDIR!!/config ,
which may be overridden in the system config file in
.I !!SYSCONFDIR!!/openisr.conf
or the user config file in
.IR ~/.openisrrc .
If necessary, however, the server can be specified on
the command line using the
.B -s 
command line option.

By default, the 
.I current ISR userid
is the current Unix login name. This can be overridden by 
setting the
.I userid
config option in 
.I !!SYSCONFDIR!!/openisr.conf
or
.IR ~/.openisrrc ,
which in turn can be overridden by specifying the  
.B -u
option on the command line.

You can safely attempt to interrupt any
.B isr
command at any time by typing control-c (SIGINT).  Regions of commands
that should not be interrupted will ignore these SIGINT signals.

.SH COMMANDS 

.TP
.BI "isr auth"
Authenticate to the ISR server. You will be prompted for your ISR
password.  Run this command once, at the beginning of each X session
to avoid having to keep typing your ISR password.


.TP
.BI "isr checkin(ci) " parcel " [-b " "KBytes/s" "]"
Checkin a 
.I parcel 
to the server. This command creates a new checkpointed version
of the parcel on the server, and then releases a lock on the
parcel so that it can be resumed by other client hosts.
The 
.BI -b 
.I KBytes/s
option limits the upload bandwidth to 
.I KBytes/s.

The
.B checkin
command is 
.IR idempotent , 
meaning that it can be safely interrupted with ctrl-c and rerun until
it successfully completes.

.TP
.BI "isr checkout(co) " "parcel" " [-c] [-d] [-r " "oldversion" "]"
Download  a 
.I parcel 
from the server without running it.  This command acquires a lock on the
parcel and downloads the minimum amount of virtual machine state needed to
run the parcel on the client host.

By default, the 
.B checkout
command downloads the most recent parcel
version. However, you can rollback to previous parcel versions using
the
.BI -r 
.I oldversion
option. Let 
.I lastversion
be the most recent parcel version on the server. Then
.B -r 
.I oldversion
causes the server to first create a new version
.I lastversion+1
that is an identical copy  of version
.IR oldversion .
This new version, which is now the most recent version, 
is then downloaded as before. 

The
.B -d
option will additionally
.B hoard
the parcel after downloading it, ensuring that you will be able to
.B resume
the parcel when disconnected from the network.  The
.B -c
option, when used in conjunction with the
.B -d
option, performs lengthy consistency checks on the hoard cache after
hoarding has completed.

The 
.B checkout
command is useful for preparing a parcel to run
.IR disconnected ,
but it is normally subsumed by the 
.B resume 
command when you are running
.IR connected .
Even in connected mode, it can be useful in some situations.
For example, you might want to use the 
.B stat
command (which requires the parcel to be checked out) 
before you actually run the parcel.


.TP
.BI "isr checkp " "parcel" " [-e] [-r " "version" "] [-c]"
This is a debugging command that checks a 
.I parcel 
for consistency.  By default, this command performs fast sanity checks
on the local cache of a checked-out
.IR parcel .
The
.B -e
option causes the command to check a particular version of the
.I parcel
on the server instead.  By default,
.B -e
checks the most recent
.IR version ,
but the
.B -r
option can be used to specify a different
.I version
instead.  The
.B -c
option performs an additional (and time-consuming) content consistency
check on the server
.I version
(if 
.B -e
is specified) or on the local cache (otherwise).

.TP
.B "isr checkhoard [-c]"
This is a debugging command that checks the hoard cache for consistency
and repairs any problems it finds.  By default, this command performs
fast checks on the hoard cache indexes.  The
.B -c
option causes it to perform an additional (and time-consuming) content
consistency check.

.TP
.BI "isr clean " "parcel"
Remove  
.I parcel 
from the client host and forcibly release its
server lock. This command can be used to release the lock on a parcel
from any machine, which is handy if you've forgotten to checkin the
parcel and want to use it from another machine.

.TP
.BI "isr deauth" 
Remove the authentication credentials that were established by the
.B auth
command.

.TP
.BI "isr discard " "parcel"
Discard all local client changes to 
.I parcel 
since the last 
.B checkout
or 
.B sync.  
This command can be useful for speeding up the
.B checkin 
command after brief ISR sessions where you don't need to save any of
the changes you made. It is also useful for "micro-rollbacks" that allow 
you to recover from mistakes during the current session. For example, 
if you inadvertently type "rm -rf /bin" as root in the guest, the
.B
discard 
command will allow you to rollback to the parcel that existed at the time
of the most recent 
.B
checkout 
or
.B
sync
command.

.TP
.BI "isr help"
Display a brief usage summary.

.TP
.BI "isr hoard " "parcel"
Fetch the parcel's entire virtual disk into the hoard cache
on the client. This command
fetches only the blocks that are missing on the client. You can kill
it with
.B ctrl-c
and rerun it as many times as you wish without any ill effects.

You can hoard a parcel anytime and anywhere, even if other
.B isr 
commands are currently running, and even if the parcel is not
currently checked out on the client host.

.TP
.BI "isr ls [" parcel "] [-l|-L " "n" "]"
List information about your parcels. By default, this command displays
the status of all of the user's parcels that are managed by the
default server. The display identifies the server, and then for
each parcel, prints a single line with the name, the current lock status
.IR "" ( acquired " or " released ),
the user and client host that last changed the lock status, and the
time of that change.  

If a specific parcel is named on the command line, only information
about that parcel will be shown.  The 
.B -L
option requests a long listing format, printing 
additional information about the 
.I n
most recent parcel versions.
The 
.B -l 
option is similar, printing information for some
small default number of the most recent versions.

.TP
.B isr lshoard [-l]
List information about the parcels currently in the hoard cache.  The
.B -l
option causes additional information to be displayed, including parcel
UUIDs for passing to the
.B rmhoard
command.

.TP
.BI "isr passwd" 
Change your ISR password.
This command does 
.B NOT 
change the password of the Unix login
account on your client host. (Use the local
.B passwd
command for that.)  

.TP
.BI "isr resume " "parcel" " [-r " "oldversion" "] [-c] [-d] [-F]"
Checkout a 
.I parcel
(if necessary) and then run it. Any additional state that the parcel
needs while it is running, beyond that downloaded by the checkout operation,
will be demand-paged from the server.

By default, the 
.B resume 
command requires a network connection. 
However, if the parcel is fully hoarded then you can use the 
.B -d
option to resume
.IR disconnected .
If the parcel is not fully hoarded, the
.B -d
option will cause the parcel to be hoarded (which requires a network
connection) and then will resume disconnected.  (To ensure that no network
access is needed in order to resume disconnected, run
.B checkout -d
beforehand to ensure that the parcel is both checked out and fully
hoarded.)  The
.B -c
option, when used in conjunction with
.BR -d ,
will cause a lengthy consistency check to be performed on the hoard
cache before resuming.

The
.B -r
option allows you to rollback to previous parcel versions, 
as described in the documentation for the 
.B checkout
command.  The 
.B -F 
option causes the parcel to be resumed in a window rather than in
full-screen mode, which can be useful for configuring the virtual
machine monitor or for running multiple parcels at once.

.TP
.BI "isr rmhoard " parcel
Remove hoarded state for
.I parcel
from the client.  If
.I parcel
is currently checked out, it can be specified by name; otherwise,
it must be specified by its UUID.  The
.I parcel
UUID can be obtained with the
.B lshoard -l
command.

.TP
.BI "isr stat " parcel
Display information about the local state of a 
.IR parcel ,
such as the amount of state demand-paged from the server,
the amount of dirty state, and the amount of state that
is hoarded in the persistent hoard cache. The
.I parcel
must be checked out in order to use the
.B stat
command.

.TP
.BI "isr sync " parcel " [-b " "KBytes/s" "]"
Save a new checkpointed version of 
.I parcel 
on the server, without releasing the lock or 
.BR discard ing 
any of the current local state. You can
.B sync
as often as you like between 
.B resume
commands. 
The 
.BI -b 
.I KBytes/s
option limits the upload bandwidth to 
.IR KBytes/s .

The
.B sync
command is 
.IR idempotent , 
meaning that it can be safely interrupted with ctrl-c and rerun until
it successfully completes.


.TP
.BI "isr version"
Display the version of the ISR client.

.SH OPTIONS
Each option has equivalent short and long forms.

.TP
.BI -b/--bwlimit " KBytes/s"
Limit upload bandwidth 
during
.B checkin
and 
.B sync
to 
.IR KBytes/s .

.TP
.B -c/--checkstate
Perform an additional content consistency check during the 
.BR checkp ", " checkhoard ", " checkout ", and " resume
commands.

.TP
.B -d/--disconnected
.B Resume
disconnected (after hoarding), or ensure that the parcel can later
be resumed disconnected.

.TP
.B -e/--remote
For
.BR checkp ,
check the parcel on the server rather than on the client.

.TP
.B -F/--no-fullscreen
When the parcel is resumed, display it in a window rather than in
full-screen mode.

.TP
.B -l/--long
Use long listing format for the 
.B ls
command, printing information about some small default 
number of the most recent parcel versions.

.TP
.BI -L/--longvers " n"
Use long listing format for the 
.B ls
command, printing information about the 
.I n
most recent parcel versions.

.TP
.B -q/--quiet
Run silently (except if things go wrong).

.TP
.BI -r/--rollback " version"
Optional parcel version number for the 
.BR checkout , " resume" ", and " checkp
commands. For 
.BR checkout " and " resume
it determines the parcel
.I version 
to rollback to. For
.B checkp
it determines the parcel
.I version
to check for consistency if
.B -e
is specified.

.TP
.BI -s/--server " name"
Use the server 
.IR name ,
overriding the default.
.I name
can be a fully qualified domain name or an IP address.

.TP
.BI -u/--user " userid"
By default, the current ISR userid is the current Unix login name
or the value of the
.I userid
variable from the configuration files.  This
option overrides both of these and sets the current ISR userid to
.IR userid .

.TP
.B -v/--verbose
Increment the verbosity level. 

.SH EXAMPLES

Here is how you might use
.B isr
during a typical day: 

After arriving at work, you login to your ISR client host. Next, you will
need to authenticate to the ISR server,

.RS
\fC$ isr auth\fP
.RE

which prompts you for your ISR password.  You are now authenticated
and will not need to type this password again until you either explicitly
.B deauth
or terminate your X session.

After listing your available parcels,

.RS
\fC$ isr ls\fP
.RE

you decide to resume the Windows parcel called 
.I winxp
in connected mode:

.RS
\fC$ isr resume winxp\fP
.RE

This downloads parcel
.I winxp
(if necessary)
and executes it inside the virtual machine monitor (VMM).

After running the parcel all morning, you realize you need to head out
to a lunch meeting in a conference room with poor wireless
connectivity. So you suspend the current running parcel, which causes
the VMM to return control to the Linux shell.  After making sure that
it is safe to run disconnected (i.e., your parcel state is hoarded), 

.RS
\fC$ isr co winxp -d\fP
.RE

you unplug the network cable, carry your laptop to the noon meeting, 
and then run you parcel disconnected during the meeting:

.RS
\fC$ isr resume winxp -d\fP
.RE

After the meeting, you head back to the office, plug your network
cable back in, and create a checkpointed version of your current
parcel state on the server:

.RS
\fC$ isr sync winxp\fP
.RE

After running connected for the rest of the day, it's time to head
home. So you terminate the ISR session by checking in your parcel:

.RS
\fC$ isr ci winxp\fP
.RE

Once home, you login to your home ISR client, authenticate to the ISR
server, and then checkout the parcel that you were working on at work:

.RS
\fC$ isr resume winxp\fP
.RE

.SH FILES
.TP
.I !!BINDIR!!/isr
The ISR client program.

.TP
.I !!SHAREDIR!!/config
Configuration file that specifies defaults for ISR configuration options.
This file should not be modified; changes should be made in the system-wide
or user-specific config files instead.

.TP
.I !!SYSCONFDIR!!/openisr.conf
Configuration file that specifies system-wide settings.  Options in this
file override those in
.IR !!SHAREDIR!!/config .

.TP
.I ~/.openisrrc
Configuration file that specifies user-specific settings.  Options in this
file override those in
.IR !!SHAREDIR!!/config " and " !!SYSCONFDIR!!/openisr.conf .

.TP
.I !!LIBDIR!!/parcelkeeper
The user-level process that demand-pages state from the server while the
parcel is running.

.SH ACKNOWLEDGMENTS
ISR was developed by Michael Kozuch and Casey Helfrich from Intel
Research Pittsburgh; David O'Hallaron, Mahadev (Satya) Satyanarayanan,
Matt Toups, and Benjamin Gilbert from Carnegie Mellon; and Partho Nath
from Penn State.  Internet Suspend/Resume and OpenISR are registered
trademarks of Carnegie Mellon University.

.SH SEE ALSO
.BR openisr-config (8)

.\" end of file
